<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        /* --- CSS ‡πÅ‡∏ï‡πà‡∏á‡∏™‡∏ß‡∏¢ --- */
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #f7f7f7; /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡∏≠‡πà‡∏≠‡∏ô */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: #333;
        }

        .container {
            background-color: #fff;
            width: 100%;
            max-width: 400px; /* ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
            padding: 30px;
            border-radius: 15px; /* ‡∏°‡∏∏‡∏°‡πÇ‡∏Ñ‡πâ‡∏á */
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); /* ‡πÄ‡∏á‡∏≤‡∏ü‡∏∏‡πâ‡∏á‡πÜ */
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
        }

        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô */
        .balance-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .box {
            flex: 1;
            padding: 10px;
            margin: 0 5px;
            border-radius: 10px;
            color: #fff;
        }

        .box-income { background-color: #2ecc71; } /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
        .box-expense { background-color: #e74c3c; } /* ‡πÅ‡∏î‡∏á */
        .box-total { background-color: #3498db; }  /* ‡∏ü‡πâ‡∏≤ */

        h3 { margin: 0; font-size: 14px; opacity: 0.9; }
        p { margin: 5px 0 0; font-size: 18px; font-weight: bold; }

        /* ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
        .form-control {
            margin-bottom: 10px;
        }
        
        input, select, button {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Kanit', sans-serif;
            box-sizing: border-box; /* ‡πÉ‡∏´‡πâ padding ‡πÑ‡∏°‡πà‡∏î‡∏±‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡∏¢‡∏≤‡∏¢ */
        }

        button {
            background-color: #9b59b6; /* ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á */
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
            transition: 0.3s;
        }

        button:hover { background-color: #8e44ad; }

        /* ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ */
        ul {
            list-style-type: none;
            padding: 0;
            margin-top: 20px;
        }

        li {
            background-color: #fff;
            border-bottom: 1px solid #eee;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        li:last-child { border-bottom: none; }

        .money-plus { color: #2ecc71; font-weight: bold; }
        .money-minus { color: #e74c3c; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üí∞ ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö-‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h1>

        <div class="balance-container">
            <div class="box box-income">
                <h3>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</h3>
                <p id="money-plus">+0.00</p>
            </div>
            <div class="box box-expense">
                <h3>‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h3>
                <p id="money-minus">-0.00</p>
            </div>
            <div class="box box-total">
                <h3>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h3>
                <p id="balance">0.00</p>
            </div>
        </div>

        <div style="border-top: 2px dashed #eee; margin: 20px 0;"></div>
        
        <div class="form-control">
            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
            <input type="text" id="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß, ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô...">
        </div>
        
        <div class="form-control">
            <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
            <input type="number" id="amount" placeholder="0">
        </div>

        <div class="form-control">
            <select id="type">
                <option value="expense">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (-)</option>
                <option value="income">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (+)</option>
            </select>
        </div>

        <button onclick="addTransaction()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>

        <h3 style="margin-top: 20px; color: #666;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
        <ul id="list">
            </ul>
    </div>

    <script>
        // --- 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Logic ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÅ‡∏ï‡πà‡πÅ‡∏Å‡πâ URL ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Relative Path ‡πÅ‡∏•‡πâ‡∏ß) ---
        async function getTransactions() {
            try {
                const response = await fetch('/api/transactions');
                const res = await response.json();

                if (res.success) {
                    const list = document.getElementById('list');
                    list.innerHTML = ''; 
                    
                    let income = 0;
                    let expense = 0;

                    res.data.forEach(item => {
                        const li = document.createElement('li');
                        // ‡πÉ‡∏™‡πà class ‡πÉ‡∏´‡πâ‡∏™‡∏µ‡∏™‡∏ß‡∏¢‡πÜ
                        const sign = item.type === 'expense' ? '-' : '+';
                        const amountClass = item.type === 'expense' ? 'money-minus' : 'money-plus';

                        li.innerHTML = `
                            <span>${item.text}</span>
                            <span class="${amountClass}">${sign}${item.amount.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                        `;
                        
                        list.appendChild(li);

                        if (item.type === 'income') income += item.amount;
                        else expense += item.amount;
                    });

                    // ‡πÉ‡∏ä‡πâ toLocaleString() ‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≥‡∏Ñ‡∏±‡πà‡∏ô (‡πÄ‡∏ä‡πà‡∏ô 20,000)
                    document.getElementById('money-plus').innerText = `+${income.toLocaleString()}`;
                    document.getElementById('money-minus').innerText = `-${expense.toLocaleString()}`;
                    document.getElementById('balance').innerText = `${(income - expense).toLocaleString()}`;
                }
            } catch (err) {
                console.error('Error:', err);
            }
        }

        // --- 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ---
        async function addTransaction() {
            const text = document.getElementById('text').value;
            const amount = document.getElementById('amount').value;
            const type = document.getElementById('type').value;

            if (text.trim() === '' || amount.trim() === '') {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }

            const transactionData = {
                text: text,
                amount: Number(amount),
                type: type
            };

            try {
                const response = await fetch('/api/transactions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(transactionData)
                });

                const res = await response.json();

                if (res.success) {
                    document.getElementById('text').value = '';
                    document.getElementById('amount').value = '';
                    getTransactions(); 
                }
            } catch (err) {
                console.error('Error:', err);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
            }
        }
        
        getTransactions();
    </script>
</body>
</html>